<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - Register Card</title>
    <link rel="stylesheet" href="/css/card-list.css" />
    <style>
      * {
        box-sizing: border-box;
      }
      .admin-container {
        max-width: 600px;
        margin: 50px auto;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      
      /* ëª¨ë°”ì¼ ëŒ€ì‘ */
      @media (max-width: 768px) {
        body {
          padding: 10px;
        }
        .admin-container {
          margin: 20px auto;
          padding: 20px;
          width: 100%;
          max-width: 100%;
        }
        .usd-input-wrapper,
        .price-input-wrapper {
          margin-bottom: 15px;
        }
      }
      .form-group {
        margin-bottom: 20px;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
      }
      .form-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
      }
      .price-input-wrapper {
        position: relative;
      }
      .price-input-wrapper::before {
        content: "â‚©";
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #666;
        font-weight: bold;
        z-index: 1;
      }
      .price-input-wrapper input {
        padding-left: 30px;
      }
      .usd-input-wrapper {
        position: relative;
      }
      .usd-input-wrapper::before {
        content: "$";
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #666;
        font-weight: bold;
        z-index: 1;
      }
      .usd-input-wrapper input {
        padding-left: 30px;
      }
      .help-text {
        font-size: 0.85em;
        color: #888;
        margin-top: 5px;
      }
      .btn-submit {
        width: 100%;
        padding: 12px;
        background: #4338ca;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 1em;
        cursor: pointer;
      }
      .btn-submit:hover {
        background: #3730a3;
      }
      .alert {
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
      }
      .alert-success {
        background: #dcfce7;
        color: #166534;
      }
      .alert-error {
        background: #fee2e2;
        color: #991b1b;
      }
      /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
      .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        z-index: 9999;
        justify-content: center;
        align-items: center;
      }
      .loading-overlay.active {
        display: flex;
      }
      .loading-content {
        background: white;
        padding: 40px;
        border-radius: 10px;
        text-align: center;
        max-width: 400px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }
      .loading-spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #4338ca;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .loading-text {
        font-size: 1.1em;
        color: #333;
        margin-bottom: 15px;
        font-weight: bold;
      }
      .loading-progress {
        width: 100%;
        height: 8px;
        background-color: #e0e0e0;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 15px;
      }
      .loading-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #4338ca, #6366f1);
        width: 0%;
        animation: progress 2s ease-in-out infinite;
        border-radius: 4px;
      }
      @keyframes progress {
        0% {
          width: 0%;
        }
        50% {
          width: 70%;
        }
        100% {
          width: 100%;
        }
      }
      .loading-steps {
        margin-top: 15px;
        font-size: 0.9em;
        color: #666;
      }
      .loading-step {
        margin: 5px 0;
        opacity: 0.6;
      }
      .loading-step.active {
        opacity: 1;
        color: #4338ca;
        font-weight: bold;
      }
      .admin-tab-btn {
        padding: 12px 24px;
        background: #e5e7eb;
        color: #666;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-block;
      }
      .admin-tab-btn:hover {
        background: #d1d5db;
      }
      .admin-tab-btn.active {
        background: #4338ca;
        color: white;
      }
      #listSection {
        display: none;
      }
      /* ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
      .cardCategory-dropdown {
        position: relative;
        display: block;
        width: 100%;
        max-width: 400px;
        margin: 0 auto 30px;
      }
      .cardCategory-dropdown-select {
        width: 100%;
        padding: 12px 16px;
        font-size: 1.1em;
        font-weight: bold;
        border: 2px solid #4338ca;
        border-radius: 8px;
        background: white;
        color: #333;
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%234338ca' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 16px center;
        transition: all 0.3s;
        box-sizing: border-box;
      }
      .cardCategory-dropdown-select:hover {
        border-color: #3730a3;
        background-color: #f9fafb;
      }
      .cardCategory-dropdown-select:focus {
        outline: none;
        border-color: #3730a3;
        box-shadow: 0 0 0 3px rgba(67, 56, 202, 0.1);
      }
      .form-section {
        display: none;
      }
      .form-section.active {
        display: block;
      }
    </style>
  </head>
  <body>
    <div style="text-align: center; margin-bottom: 30px; margin-top: 20px;">
      <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
        <a href="/cards" class="admin-tab-btn">â† Go to Market</a>
        <a href="/admin/notices" class="admin-tab-btn" style="background: #6b7280; color: white;">ğŸ“¢ ê³µì§€ì‚¬í•­ ê´€ë¦¬</a>
      </div>
    </div>

    <div class="admin-container">
      <div
        style="
          display: flex;
          gap: 10px;
          justify-content: center;
          margin-bottom: 30px;
        "
      >
        <button
          id="registerBtn"
          class="admin-tab-btn active"
          onclick="showRegisterForm()"
        >
          ì¹´ë“œ ë“±ë¡
        </button>
        <button id="listBtn" class="admin-tab-btn" onclick="showCardList()">
          ì¹´ë“œ ëª©ë¡ ë³´ê¸°
        </button>
      </div>

      <div id="registerSection">
        <h2 style="margin-top: 0; text-align: center">ì¹´ë“œ ë“±ë¡</h2>
        
        <!-- ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ -->
        <div class="cardCategory-dropdown">
          <select id="categorySelect" class="cardCategory-dropdown-select" onchange="showCategoryForm(this.value)">
            <option value="">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
            <option value="pokemon-single">í¬ì¼“ëª¬ ì‹±ê¸€ ì¹´ë“œ</option>
            <option value="pokemon-box">í¬ì¼“ëª¬ Box</option>
            <option value="onepiece-single">ì›í”¼ìŠ¤ ì‹±ê¸€ ì¹´ë“œ</option>
            <option value="onepiece-box">ì›í”¼ìŠ¤ Box</option>
          </select>
        </div>

        <div
          th:if="${message}"
          class="alert alert-success"
          th:text="${message}"
        ></div>
        <div
          th:if="${error}"
          class="alert alert-error"
          th:text="${error}"
        ></div>

        <!-- í¬ì¼“ëª¬ ì‹±ê¸€ ì¹´ë“œ í¼ -->
        <div id="pokemon-single-form" class="form-section">
          <p style="text-align: center; color: #666; margin-bottom: 30px">
            ì¹´ë“œì˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ <br />DBì— ìë™ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤
          </p>
          <form
            action="/admin/cards/register"
            method="post"
            enctype="multipart/form-data"
            id="pokemon-single-form-element"
          >
          <input
            type="hidden"
            th:name="${_csrf.parameterName}"
            th:value="${_csrf.token}"
          />
          <input
            type="hidden"
            name="category"
            value="pokemon-single"
          />
          <div class="form-group">
            <label for="name">í¬ì¼“ëª¬ ì´ë¦„ (Name)</label>
            <input
              type="text"
              id="name"
              name="name"
              placeholder="ì˜ˆ: Pikachu"
            />
            <div class="help-text">* ì˜ë¬¸ ì´ë¦„ ê¶Œì¥ (í•œê¸€ ê²€ìƒ‰ ë¶ˆê°€)</div>
          </div>

          <div class="form-group">
            <label for="number">ì¹´ë“œ ë²ˆí˜¸ (Number)</label>
            <input
              type="text"
              id="number"
              name="number"
              placeholder="ì˜ˆ: 025"
            />
            <div class="help-text">
              * ì¹´ë“œ í•˜ë‹¨ì˜ ìˆ«ì (ì˜ˆ: 025/165 ë¼ë©´ 025 ì…ë ¥)
            </div>
          </div>

          <div class="form-group">
            <label for="setName">ì„¸íŠ¸ ì´ë¦„ (Set Name) - ì„ íƒì‚¬í•­</label>
            <input
              type="text"
              id="setName"
              name="setName"
              placeholder="ì˜ˆ: 151, ì´ˆì „ ë¸Œë ˆì´"
            />
            <div class="help-text">
              * ì¹´ë“œê°€ ì†í•œ ì„¸íŠ¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.
            </div>
          </div>

          <div class="form-group">
            <label for="rarity">í¬ê·€ë„ (Rarity) - ì„ íƒì‚¬í•­</label>
            <select
              id="rarity"
              name="rarity"
              style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box;"
            >
              <option value="">ì„ íƒ ì•ˆ í•¨</option>
              <option th:each="rarity : ${rarities}" 
                      th:value="${rarity.name()}" 
                      th:text="${rarity.name()}">
                COMMON
              </option>
            </select>
            <div class="help-text">
              * ì¹´ë“œì˜ í¬ê·€ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”. (COMMON, UNCOMMON, RARE, HOLO_RARE, DOUBLE_RARE, ULTRA_RARE, ILLUSTRATION_RARE, SECRET_RARE, PROMO, UNKNOWN)
            </div>
          </div>

          <div class="form-group">
            <label for="cardCondition">ì¹´ë“œ ìƒíƒœ (Condition) - ì„ íƒì‚¬í•­</label>
            <select
              id="cardCondition"
              name="cardCondition"
              style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box;"
            >
              <option value="">ì„ íƒ ì•ˆ í•¨</option>
              <option th:each="condition : ${cardConditions}" 
                      th:value="${condition.name()}" 
                      th:text="${condition.name() + ' - ' + condition.description}">
                MINT - ë¯¸ê°œë´‰/ì‹ í’ˆ
              </option>
            </select>
            <div class="help-text">
              * ì¹´ë“œì˜ ìƒíƒœë¥¼ ì„ íƒí•˜ì„¸ìš”. (MINT: ë¯¸ê°œë´‰/ì‹ í’ˆ, NEAR_MINT: Sê¸‰, EXCELLENT: Aê¸‰, LIGHTLY_PLAYED: Bê¸‰, PLAYED: Cê¸‰, HEAVILY_PLAYED: Dê¸‰, DAMAGED: íŒŒì†ë¨)
            </div>
          </div>

          <div class="form-group">
            <label for="collectionStatus">ì»¬ë ‰ì…˜ ìƒíƒœ (Collection Status) - ì„ íƒì‚¬í•­</label>
            <select
              id="collectionStatus"
              name="collectionStatus"
              style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box;"
            >
              <option value="">ì„ íƒ ì•ˆ í•¨</option>
              <option th:each="status : ${collectionStatuses}" 
                      th:value="${status.name()}" 
                      th:text="${status.name() + ' - ' + status.description}">
                OWNED - ë³´ìœ ì¤‘
              </option>
            </select>
            <div class="help-text">
              * ì¹´ë“œì˜ ì»¬ë ‰ì…˜ ìƒíƒœë¥¼ ì„ íƒí•˜ì„¸ìš”. (OWNED: ë³´ìœ ì¤‘, WHISHLIST: ìœ„ì‹œë¦¬ìŠ¤íŠ¸, FOR_TRADE: êµí™˜ì¤‘, FOR_SALE: íŒë§¤ì¤‘, TRADED: êµí™˜ ì™„ë£Œ, SOLD: íŒë§¤ ì™„ë£Œ)
            </div>
          </div>

          <div class="form-group">
            <label for="quantity">ìˆ˜ëŸ‰ (Quantity) - ì„ íƒì‚¬í•­</label>
            <input
              type="text"
              id="quantity"
              name="quantity"
              placeholder="ì˜ˆ: 1"
              inputmode="numeric"
              pattern="[0-9]*"
              style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box;"
            />
            <div class="help-text">
              * ë³´ìœ  ì¤‘ì¸ ì¹´ë“œì˜ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”. ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤. (ê¸°ë³¸ê°’: 1)
            </div>
          </div>

          <div class="form-group">
            <label for="imageFile">ì¹´ë“œ ì´ë¯¸ì§€ ì—…ë¡œë“œ - ì„ íƒì‚¬í•­</label>
            <input
              type="file"
              id="imageFile"
              name="imageFile"
              accept="image/*"
              style="padding: 8px"
            />
            <div class="help-text">
              * ë¡œì»¬ ì»´í“¨í„°ì—ì„œ ì¹´ë“œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (jpg, png,
              gif, webp)
            </div>
            <div id="imagePreview" style="margin-top: 10px; display: none">
              <img
                id="previewImg"
                src=""
                alt="ë¯¸ë¦¬ë³´ê¸°"
                style="
                  max-width: 300px;
                  max-height: 300px;
                  border: 1px solid #ddd;
                  border-radius: 5px;
                "
              />
            </div>
          </div>

          <div class="form-group">
            <label for="salePrice">íŒë§¤ ê°€ê²© (ì›í™”) - ì„ íƒì‚¬í•­</label>
            <div class="price-input-wrapper">
              <input
                type="text"
                id="salePrice"
                name="salePrice"
                placeholder="ì˜ˆ: 50000"
                inputmode="numeric"
                pattern="[0-9]*"
              />
            </div>
            <div class="help-text">
              * íŒë§¤í•˜ê³ ì í•˜ëŠ” ê°€ê²©ì„ ì›í™”(â‚©)ë¡œ ì…ë ¥í•˜ì„¸ìš”. ìˆ«ìë§Œ ì…ë ¥
              ê°€ëŠ¥í•©ë‹ˆë‹¤.
            </div>
          </div>

          <div class="form-group">
            <label for="currentPriceUsd">í˜„ì¬ ì‹œì„¸ (USD) - ì„ íƒì‚¬í•­</label>
            <div class="usd-input-wrapper">
              <input
                type="text"
                id="currentPriceUsd"
                name="currentPriceUsd"
                placeholder="25.99"
                inputmode="decimal"
                pattern="[0-9]+(\.[0-9]+)?"
              />
            </div>
            <div class="help-text">
              * ì¹´ë“œì˜ í˜„ì¬ ì‹œì„¸ë¥¼ USDë¡œ ì…ë ¥í•˜ì„¸ìš”. ì†Œìˆ˜ì  í¬í•¨ ê°€ëŠ¥í•©ë‹ˆë‹¤. (ì˜ˆ: 25.99)
              <br>* ì…ë ¥ëœ ì‹œì„¸ëŠ” ê·¸ë˜í”„ ë°ì´í„°ë¡œ ì¶•ì ë˜ì–´ ê°€ê²© ì¶”ì´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
          </div>

          <button type="submit" class="btn-submit" id="submitBtn">
            ì¹´ë“œ ê²€ìƒ‰ ë° ë“±ë¡
          </button>
        </form>
        </div>

        <!-- í¬ì¼“ëª¬ Box í¼ -->
        <div id="pokemon-box-form" class="form-section">
          <p style="text-align: center; color: #666; margin-bottom: 30px">
            í¬ì¼“ëª¬ Box ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ <br />DBì— ìë™ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤
          </p>
          <div style="text-align: center; padding: 40px; background: #f9fafb; border-radius: 8px; color: #666;">
            <p style="font-size: 1.1em; margin-bottom: 10px;">í¬ì¼“ëª¬ Box ë“±ë¡ ê¸°ëŠ¥</p>
            <p>ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ê³§ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
          </div>
        </div>

        <!-- ì›í”¼ìŠ¤ ì‹±ê¸€ ì¹´ë“œ í¼ -->
        <div id="onepiece-single-form" class="form-section">
          <p style="text-align: center; color: #666; margin-bottom: 30px">
            ì›í”¼ìŠ¤ ì¹´ë“œì˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ <br />DBì— ìë™ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤
          </p>
          <div style="text-align: center; padding: 40px; background: #f9fafb; border-radius: 8px; color: #666;">
            <p style="font-size: 1.1em; margin-bottom: 10px;">ì›í”¼ìŠ¤ ì‹±ê¸€ ì¹´ë“œ ë“±ë¡ ê¸°ëŠ¥</p>
            <p>ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ê³§ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
          </div>
        </div>

        <!-- ì›í”¼ìŠ¤ Box í¼ -->
        <div id="onepiece-box-form" class="form-section">
          <p style="text-align: center; color: #666; margin-bottom: 30px">
            ì›í”¼ìŠ¤ Box ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ <br />DBì— ìë™ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤
          </p>
          <div style="text-align: center; padding: 40px; background: #f9fafb; border-radius: 8px; color: #666;">
            <p style="font-size: 1.1em; margin-bottom: 10px;">ì›í”¼ìŠ¤ Box ë“±ë¡ ê¸°ëŠ¥</p>
            <p>ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ê³§ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
          </div>
        </div>
      </div>

      <!-- ì¹´ë“œ ëª©ë¡ ì„¹ì…˜ (ê°™ì€ í˜ì´ì§€ì—ì„œ í‘œì‹œ) -->
      <div id="listSection">
        <h2 style="margin-top: 0; text-align: center">ë“±ë¡ëœ ì¹´ë“œ ëª©ë¡</h2>
        <p style="text-align: center; color: #666; margin-bottom: 30px">
          ì§€ê¸ˆê¹Œì§€ ë“±ë¡ëœ ëª¨ë“  ì¹´ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
        <div style="text-align: center; margin-bottom: 20px">
          <a
            href="/admin/cards/list"
            class="admin-tab-btn"
            style="text-decoration: none; display: inline-block"
          >
            ì „ì²´ ëª©ë¡ ë³´ê¸° â†’
          </a>
        </div>
      </div>

      <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
      <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
          <div class="loading-spinner"></div>
          <div class="loading-text">ì¹´ë“œ ë“±ë¡ ì¤‘...</div>
          <div class="loading-progress">
            <div class="loading-progress-bar"></div>
          </div>
          <div class="loading-steps">
            <div class="loading-step active" id="step1">
              âœ“ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘...
            </div>
            <div class="loading-step" id="step2">
              APIì—ì„œ ì¹´ë“œ ì •ë³´ ê²€ìƒ‰ ì¤‘...
            </div>
            <div class="loading-step" id="step3">ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ ì¤‘...</div>
          </div>
        </div>
      </div>

      <script>
        // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥
        document
          .getElementById("imageFile")
          .addEventListener("change", function (e) {
            const file = e.target.files[0];
            const previewDiv = document.getElementById("imagePreview");
            const previewImg = document.getElementById("previewImg");

            if (file) {
              const reader = new FileReader();
              reader.onload = function (e) {
                previewImg.src = e.target.result;
                previewDiv.style.display = "block";
              };
              reader.readAsDataURL(file);
            } else {
              previewDiv.style.display = "none";
            }
          });

        // íŒë§¤ ê°€ê²© ì…ë ¥ë€: ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•˜ë„ë¡ ì œí•œ
        document
          .getElementById("salePrice")
          .addEventListener("input", function (e) {
            // ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ì ì œê±°
            this.value = this.value.replace(/[^0-9]/g, "");
          });

        // ìˆ«ì í‚¤ë§Œ í—ˆìš© (ë°±ìŠ¤í˜ì´ìŠ¤, ì‚­ì œ, íƒ­, í™”ì‚´í‘œ ë“±ì€ í—ˆìš©)
        document
          .getElementById("salePrice")
          .addEventListener("keydown", function (e) {
            // ìˆ«ì í‚¤ (0-9), ë°±ìŠ¤í˜ì´ìŠ¤, ì‚­ì œ, íƒ­, í™”ì‚´í‘œ í‚¤ëŠ” í—ˆìš©
            if (
              !(
                (e.key >= "0" && e.key <= "9") ||
                e.key === "Backspace" ||
                e.key === "Delete" ||
                e.key === "Tab" ||
                e.key === "ArrowLeft" ||
                e.key === "ArrowRight" ||
                e.key === "ArrowUp" ||
                e.key === "ArrowDown"
              )
            ) {
              e.preventDefault();
            }
          });

        // í˜„ì¬ ì‹œì„¸(USD) ì…ë ¥ë€: ìˆ«ìì™€ ì†Œìˆ˜ì ë§Œ ì…ë ¥ ê°€ëŠ¥í•˜ë„ë¡ ì œí•œ
        document
          .getElementById("currentPriceUsd")
          .addEventListener("input", function (e) {
            // ìˆ«ìì™€ ì†Œìˆ˜ì ë§Œ í—ˆìš© (ì†Œìˆ˜ì ì€ í•˜ë‚˜ë§Œ)
            let value = this.value;
            // ìˆ«ì, ì†Œìˆ˜ì , ë°±ìŠ¤í˜ì´ìŠ¤, ì‚­ì œ ì™¸ì˜ ë¬¸ì ì œê±°
            value = value.replace(/[^0-9.]/g, "");
            // ì†Œìˆ˜ì ì´ ì—¬ëŸ¬ ê°œì¸ ê²½ìš° ì²« ë²ˆì§¸ë§Œ ìœ ì§€
            const parts = value.split(".");
            if (parts.length > 2) {
              value = parts[0] + "." + parts.slice(1).join("");
            }
            // ì†Œìˆ˜ì  ë‘ ìë¦¬ê¹Œì§€ë§Œ í—ˆìš©
            if (parts.length === 2 && parts[1].length > 2) {
              value = parts[0] + "." + parts[1].substring(0, 2);
            }
            this.value = value;
          });

        // í˜„ì¬ ì‹œì„¸(USD) ì…ë ¥ë€: í‚¤ë³´ë“œ ì…ë ¥ ì œí•œ
        document
          .getElementById("currentPriceUsd")
          .addEventListener("keydown", function (e) {
            // ìˆ«ì í‚¤ (0-9), ì†Œìˆ˜ì (.), ë°±ìŠ¤í˜ì´ìŠ¤, ì‚­ì œ, íƒ­, í™”ì‚´í‘œ í‚¤ë§Œ í—ˆìš©
            if (
              !(
                (e.key >= "0" && e.key <= "9") ||
                e.key === "." ||
                e.key === "Backspace" ||
                e.key === "Delete" ||
                e.key === "Tab" ||
                e.key === "ArrowLeft" ||
                e.key === "ArrowRight" ||
                e.key === "ArrowUp" ||
                e.key === "ArrowDown"
              )
            ) {
              e.preventDefault();
            }
            // ì†Œìˆ˜ì ì´ ì´ë¯¸ ìˆìœ¼ë©´ ë˜ ì…ë ¥í•˜ì§€ ëª»í•˜ê²Œ
            if (e.key === "." && this.value.includes(".")) {
              e.preventDefault();
            }
          });

        // ìˆ˜ëŸ‰ ì…ë ¥ë€: ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•˜ë„ë¡ ì œí•œ
        document
          .getElementById("quantity")
          .addEventListener("input", function (e) {
            // ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ì ì œê±°
            this.value = this.value.replace(/[^0-9]/g, "");
          });

        // ìˆ˜ëŸ‰ ì…ë ¥ë€: í‚¤ë³´ë“œ ì…ë ¥ ì œí•œ
        document
          .getElementById("quantity")
          .addEventListener("keydown", function (e) {
            // ìˆ«ì í‚¤ (0-9), ë°±ìŠ¤í˜ì´ìŠ¤, ì‚­ì œ, íƒ­, í™”ì‚´í‘œ í‚¤ë§Œ í—ˆìš©
            if (
              !(
                (e.key >= "0" && e.key <= "9") ||
                e.key === "Backspace" ||
                e.key === "Delete" ||
                e.key === "Tab" ||
                e.key === "ArrowLeft" ||
                e.key === "ArrowRight" ||
                e.key === "ArrowUp" ||
                e.key === "ArrowDown"
              )
            ) {
              e.preventDefault();
            }
          });

        // í¼ ì œì¶œ ì‹œ ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ
        document.querySelectorAll("form").forEach(form => {
          form.addEventListener("submit", function (e) {
          const loadingOverlay = document.getElementById("loadingOverlay");
          const submitBtn = document.getElementById("submitBtn");
          const imageFile = document.getElementById("imageFile");

          // í¼ ìœ íš¨ì„± ê²€ì‚¬
          const name = document.getElementById("name").value.trim();
          const number = document.getElementById("number").value.trim();
          const setId = document.getElementById("setId").value.trim();

          if (!name && !number && !setId && !imageFile.files.length) {
            e.preventDefault();
            alert("ìµœì†Œí•œ í•˜ë‚˜ì˜ ì •ë³´ëŠ” ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
            return;
          }

          // ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ
          loadingOverlay.classList.add("active");
          submitBtn.disabled = true;
          submitBtn.textContent = "ì²˜ë¦¬ ì¤‘...";

          // ë‹¨ê³„ë³„ ì• ë‹ˆë©”ì´ì…˜
          setTimeout(function () {
            document.getElementById("step1").classList.add("active");
            document.getElementById("step1").textContent =
              "âœ“ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ";
          }, 500);

          setTimeout(function () {
            document.getElementById("step2").classList.add("active");
            document.getElementById("step2").textContent =
              "âœ“ APIì—ì„œ ì¹´ë“œ ì •ë³´ ê²€ìƒ‰ ì¤‘...";
          }, 1500);

          setTimeout(function () {
            document.getElementById("step3").classList.add("active");
            document.getElementById("step3").textContent =
              "âœ“ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ ì¤‘...";
          }, 3000);
          });
        });

        // ì¹´í…Œê³ ë¦¬ë³„ í¼ í‘œì‹œ í•¨ìˆ˜
        function showCategoryForm(cardCategory) {
          // ëª¨ë“  í¼ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
          const allForms = document.querySelectorAll('.form-section');
          allForms.forEach(form => {
            form.classList.remove('active');
          });

          // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ì— í•´ë‹¹í•˜ëŠ” í¼ í‘œì‹œ
          if (cardCategory) {
            const formId = cardCategory + '-form';
            const selectedForm = document.getElementById(formId);
            if (selectedForm) {
              selectedForm.classList.add('active');
            }
            
            // í•´ë‹¹ í¼ì˜ category hidden input ì—…ë°ì´íŠ¸
            const formElement = selectedForm.querySelector('form');
            if (formElement) {
              let categoryInput = formElement.querySelector('input[name="category"]');
              if (!categoryInput) {
                categoryInput = document.createElement('input');
                categoryInput.type = 'hidden';
                categoryInput.name = 'category';
                formElement.insertBefore(categoryInput, formElement.firstChild);
              }
              categoryInput.value = cardCategory;
            }
          }
        }

        // íƒ­ ì „í™˜ ê¸°ëŠ¥
        function showRegisterForm() {
          document.getElementById("registerSection").style.display = "block";
          document.getElementById("listSection").style.display = "none";
          document.getElementById("registerBtn").classList.add("active");
          document.getElementById("listBtn").classList.remove("active");
          
          // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” ë° í¬ì¼“ëª¬ ì‹±ê¸€ ì¹´ë“œ í¼ í‘œì‹œ
          const categorySelect = document.getElementById("categorySelect");
          if (categorySelect && !categorySelect.value) {
            categorySelect.value = "pokemon-single";
            showCategoryForm("pokemon-single");
          }
        }

        function showCardList() {
          // ê°™ì€ í˜ì´ì§€ì—ì„œ ì„¹ì…˜ ì „í™˜
          document.getElementById("registerSection").style.display = "none";
          document.getElementById("listSection").style.display = "block";
          document.getElementById("registerBtn").classList.remove("active");
          document.getElementById("listBtn").classList.add("active");

          const listSection = document.getElementById("listSection");
          // ê¸°ì¡´ ë‚´ìš©ì„ ì´ˆê¸°í™”í•˜ê³  ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ
          listSection.innerHTML = `
            <h2 style="margin-top: 0; text-align: center">ë“±ë¡ëœ ì¹´ë“œ ëª©ë¡</h2>
            <p style="text-align: center; color: #666; margin-bottom: 30px">
              ì§€ê¸ˆê¹Œì§€ ë“±ë¡ëœ ëª¨ë“  ì¹´ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
            <div style="text-align: center; margin-bottom: 20px">
              <a
                href="/admin/cards/list"
                class="admin-tab-btn"
                style="text-decoration: none; display: inline-block"
              >
                ì „ì²´ ëª©ë¡ ë³´ê¸° â†’
              </a>
            </div>
            <p style="text-align: center; color: #666;">ì¹´ë“œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
          `;

          // ì¹´ë“œ ëª©ë¡ì„ ë™ì ìœ¼ë¡œ ë¡œë“œ (AJAX)
          fetch("/admin/cards/list-data")
            .then((response) => {
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
            })
            .then((data) => {
              if (data.length === 0) {
                listSection.innerHTML = `
                  <h2 style="margin-top: 0; text-align: center">ë“±ë¡ëœ ì¹´ë“œ ëª©ë¡</h2>
                  <p style="text-align: center; color: #666; margin-bottom: 30px">
                    ì§€ê¸ˆê¹Œì§€ ë“±ë¡ëœ ëª¨ë“  ì¹´ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                  </p>
                  <div style="text-align: center; margin-bottom: 20px">
                    <a
                      href="/admin/cards/list"
                      class="admin-tab-btn"
                      style="text-decoration: none; display: inline-block"
                    >
                      ì „ì²´ ëª©ë¡ ë³´ê¸° â†’
                    </a>
                  </div>
                  <p style="text-align: center; color: #999;">ë“±ë¡ëœ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                `;
              } else {
                let html = `
                  <h2 style="margin-top: 0; text-align: center">ë“±ë¡ëœ ì¹´ë“œ ëª©ë¡</h2>
                  <p style="text-align: center; color: #666; margin-bottom: 30px">
                    ì§€ê¸ˆê¹Œì§€ ë“±ë¡ëœ ëª¨ë“  ì¹´ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                  </p>
                  <div style="text-align: center; margin-bottom: 20px">
                    <a
                      href="/admin/cards/list"
                      class="admin-tab-btn"
                      style="text-decoration: none; display: inline-block"
                    >
                      ì „ì²´ ëª©ë¡ ë³´ê¸° â†’
                    </a>
                  </div>
                  <div class="card-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; margin-top: 20px;">
                `;
                data.forEach((card) => {
                  const imageUrl = card.imageUrl || '/images/pokemon-card.png';
                  const rarity = card.rarity || 'N/A';
                  html += `
                    <div class="card-item" onclick="location.href='/cards/${card.id}'" style="cursor: pointer; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                      <div class="card-image">
                        <img src="${imageUrl}" alt="${card.name || 'Card'}" style="width: 100%; height: 300px; object-fit: contain;" 
                             onerror="this.src='/images/pokemon-card.png'; this.onerror=null;" />
                      </div>
                      <div class="card-info" style="padding: 15px;">
                        <h3 style="margin: 0 0 5px 0;">${card.name || 'Unknown'}</h3>
                        <p style="margin: 0 0 10px 0; color: #666; font-size: 0.9em;">${card.setName || 'Unknown Set'}</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                          <span style="color: #666; font-size: 0.85em;">${rarity}</span>
                          <span style="font-weight: bold; color: #4338ca;">${card.priceDisplay || 'ê°€ê²© ì •ë³´ ì—†ìŒ'}</span>
                        </div>
                      </div>
                    </div>
                  `;
                });
                html += "</div>";
                listSection.innerHTML = html;
              }
            })
            .catch((error) => {
              console.error("ì¹´ë“œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:", error);
              listSection.innerHTML = `
                <h2 style="margin-top: 0; text-align: center">ë“±ë¡ëœ ì¹´ë“œ ëª©ë¡</h2>
                <p style="text-align: center; color: #666; margin-bottom: 30px">
                  ì§€ê¸ˆê¹Œì§€ ë“±ë¡ëœ ëª¨ë“  ì¹´ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                <div style="text-align: center; margin-bottom: 20px">
                  <a
                    href="/admin/cards/list"
                    class="admin-tab-btn"
                    style="text-decoration: none; display: inline-block"
                  >
                    ì „ì²´ ëª©ë¡ ë³´ê¸° â†’
                  </a>
                </div>
                <p style="text-align: center; color: #991b1b;">ì¹´ë“œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (${error.message})</p>
              `;
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ í¼ í‘œì‹œ (í¬ì¼“ëª¬ ì‹±ê¸€ ì¹´ë“œ)
        document.addEventListener('DOMContentLoaded', function() {
          const categorySelect = document.getElementById("categorySelect");
          if (categorySelect) {
            categorySelect.value = "pokemon-single";
            showCategoryForm("pokemon-single");
          }
        });
      </script>
    </div>
  </body>
</html>
