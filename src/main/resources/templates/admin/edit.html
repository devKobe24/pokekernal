<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Admin - Edit Card</title>
    <link rel="stylesheet" href="/css/card-list.css" />
    <style>
      .admin-container {
        max-width: 600px;
        margin: 50px auto;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      .form-group {
        margin-bottom: 20px;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
      }
      .form-group input,
      .form-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
      }
      .price-input-wrapper {
        position: relative;
      }
      .price-input-wrapper::before {
        content: '₩';
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #666;
        font-weight: bold;
        z-index: 1;
      }
      .price-input-wrapper input {
        padding-left: 30px;
      }
      .help-text {
        font-size: 0.85em;
        color: #888;
        margin-top: 5px;
      }
      .btn-submit {
        width: 100%;
        padding: 12px;
        background: #4338ca;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 1em;
        cursor: pointer;
        margin-top: 10px;
      }
      .btn-submit:hover {
        background: #3730a3;
      }
      .btn-cancel {
        width: 100%;
        padding: 12px;
        background: #6b7280;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 1em;
        cursor: pointer;
        margin-top: 10px;
        text-decoration: none;
        display: block;
        text-align: center;
      }
      .btn-cancel:hover {
        background: #4b5563;
      }
      .alert {
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
      }
      .alert-success {
        background: #dcfce7;
        color: #166534;
      }
      .alert-error {
        background: #fee2e2;
        color: #991b1b;
      }
      .current-image {
        margin-top: 10px;
        max-width: 300px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <div style="text-align: center; margin-bottom: 20px">
      <a href="/admin/cards/list" class="back-btn">← 카드 목록으로 돌아가기</a>
    </div>

    <div class="admin-container">
      <h2 style="margin-top: 0; text-align: center">카드 정보 수정</h2>

      <div
        th:if="${message}"
        class="alert alert-success"
        th:text="${message}"
      ></div>
      <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

      <form th:action="@{/admin/cards/edit/{id}(id=${card.id})}" method="post" enctype="multipart/form-data">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        
        <div class="form-group">
          <label for="name">포켓몬 이름 (Name)</label>
          <input type="text" id="name" name="name" th:value="${card.name}" required />
        </div>

        <div class="form-group">
          <label for="setName">세트 이름 (Set Name)</label>
          <input type="text" id="setName" name="setName" th:value="${card.setName}" required />
        </div>

        <div class="form-group">
          <label for="number">카드 번호 (Number)</label>
          <input type="text" id="number" name="number" th:value="${card.number}" />
          <div class="help-text">예: 025/165</div>
        </div>

        <div class="form-group">
          <label for="rarity">희귀도 (Rarity)</label>
          <select id="rarity" name="rarity">
            <option value="">선택하세요</option>
            <option th:each="r : ${rarities}" 
                    th:value="${r.name()}" 
                    th:text="${r.name()}"
                    th:selected="${card.rarity == r}">
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="imageUrl">이미지 URL</label>
          <input type="text" id="imageUrl" name="imageUrl" th:value="${card.imageUrl}" />
          <div class="help-text">외부 이미지 URL을 입력하거나 아래에서 새 이미지를 업로드하세요.</div>
          <div th:if="${card.getDisplayImageUrl() != null}">
            <p style="font-size: 0.9em; color: #666; margin-top: 5px;">현재 이미지:</p>
            <img th:src="${card.getDisplayImageUrl()}" alt="현재 이미지" class="current-image" />
          </div>
        </div>

        <div class="form-group">
          <label for="imageFile">새 이미지 업로드</label>
          <input
            type="file"
            id="imageFile"
            name="imageFile"
            accept="image/*"
            style="padding: 8px;"
          />
          <div class="help-text">새 이미지를 업로드하면 기존 이미지를 대체합니다.</div>
          <div id="imagePreview" style="margin-top: 10px; display: none;">
            <img id="previewImg" src="" alt="미리보기" style="max-width: 300px; max-height: 300px; border: 1px solid #ddd; border-radius: 5px;" />
          </div>
        </div>

        <div class="form-group">
          <label for="salePrice">판매 가격 (원화)</label>
          <div class="price-input-wrapper">
            <input
              type="text"
              id="salePrice"
              name="salePrice"
              th:value="${card.salePrice}"
              placeholder="예: 50000"
              inputmode="numeric"
              pattern="[0-9]*"
            />
          </div>
          <div class="help-text">판매하고자 하는 가격을 원화(₩)로 입력하세요.</div>
        </div>

        <button type="submit" class="btn-submit">수정 완료</button>
        <a href="/admin/cards/list" class="btn-cancel">취소</a>
      </form>
    </div>

    <script>
      // 이미지 미리보기 기능
      document.getElementById('imageFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const previewDiv = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');

        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            previewImg.src = e.target.result;
            previewDiv.style.display = 'block';
          };
          reader.readAsDataURL(file);
        } else {
          previewDiv.style.display = 'none';
        }
      });

      // 판매 가격 입력란: 숫자만 입력 가능하도록 제한
      document.getElementById('salePrice').addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '');
      });
    </script>
  </body>
</html>

